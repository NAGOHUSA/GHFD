<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NAGOH Creative - Georgia House Flip Analytics</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --info-color: #9b59b6;
        }
        
        body {
            background-color: #f8f9fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .dashboard-header {
            background: linear-gradient(135deg, var(--primary-color) 0%, #34495e 100%);
            color: white;
            padding: 2rem 0;
            margin-bottom: 2rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            margin-bottom: 1.5rem;
            transition: all 0.3s ease;
            border: none;
        }
        
        .stat-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        .stat-card h2 {
            font-weight: 700;
            color: var(--primary-color);
        }
        
        .profit-positive {
            color: var(--success-color);
        }
        
        .profit-high {
            color: var(--accent-color);
        }
        
        .investor-table {
            max-height: 500px;
            overflow-y: auto;
        }
        
        .data-refresh-btn {
            background: linear-gradient(135deg, var(--secondary-color) 0%, #2980b9 100%);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .data-refresh-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
        }
        
        .parameter-control {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
            border-left: 5px solid var(--secondary-color);
        }
        
        .slider-container {
            background: linear-gradient(to right, #f8f9fa, #e9ecef);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 1rem;
        }
        
        .custom-range {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: linear-gradient(to right, var(--secondary-color), var(--info-color));
            outline: none;
            -webkit-appearance: none;
        }
        
        .custom-range::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background: white;
            border: 3px solid var(--secondary-color);
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }
        
        .value-display {
            font-weight: 700;
            color: var(--primary-color);
            font-size: 1.1rem;
        }
        
        .county-tag {
            display: inline-block;
            background: linear-gradient(135deg, var(--info-color) 0%, #8e44ad 100%);
            color: white;
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 0.85rem;
            margin: 2px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .county-tag.active {
            background: linear-gradient(135deg, var(--success-color) 0%, #229954 100%);
            box-shadow: 0 2px 8px rgba(39, 174, 96, 0.3);
        }
        
        .county-tag:hover {
            transform: scale(1.05);
        }
        
        .flip-card {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid var(--success-color);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .flip-card:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .investor-badge {
            background: linear-gradient(135deg, var(--warning-color) 0%, #e67e22 100%);
            color: white;
            padding: 3px 12px;
            border-radius: 15px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        .data-source-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 5px;
        }
        
        .data-source-live {
            background-color: var(--success-color);
            box-shadow: 0 0 8px var(--success-color);
        }
        
        .dashboard-loading {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 300px;
            flex-direction: column;
        }
        
        .dashboard-loading .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--secondary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .data-age-badge {
            background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85rem;
        }
        
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }
        
        .brand-logo {
            font-weight: 700;
            font-size: 1.5rem;
            color: white;
            text-decoration: none;
        }
        
        .brand-logo:hover {
            color: white;
            text-decoration: none;
        }
        
        .brand-subtitle {
            font-size: 0.9rem;
            opacity: 0.8;
            letter-spacing: 1px;
        }
        
        .daily-report-selector {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            border-radius: 8px;
            padding: 8px 15px;
        }
        
        .daily-report-selector:focus {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.3);
            box-shadow: 0 0 0 0.2rem rgba(255, 255, 255, 0.25);
        }
        
        .date-badge {
            background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        
        .control-group {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 3px solid var(--secondary-color);
        }
        
        .county-select-container {
            position: relative;
        }
        
        .county-search-input {
            width: 100%;
            padding: 10px 40px 10px 15px;
            border: 1px solid #ced4da;
            border-radius: 8px;
            font-size: 0.9rem;
            background: white;
        }
        
        .county-search-input:focus {
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 0.2rem rgba(52, 152, 219, 0.25);
            outline: none;
        }
        
        .county-search-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #6c757d;
        }
        
        .county-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            max-height: 300px;
            overflow-y: auto;
            background: white;
            border: 1px solid #ced4da;
            border-radius: 8px;
            margin-top: 5px;
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
            z-index: 1000;
            display: none;
        }
        
        .county-dropdown.show {
            display: block;
        }
        
        .county-dropdown-item {
            padding: 8px 15px;
            cursor: pointer;
            border-bottom: 1px solid #f1f1f1;
            transition: background 0.2s;
        }
        
        .county-dropdown-item:hover {
            background: #f8f9fa;
        }
        
        .county-dropdown-item.active {
            background: var(--secondary-color);
            color: white;
        }
        
        .selected-counties-badge {
            display: inline-block;
            background: linear-gradient(135deg, var(--success-color) 0%, #229954 100%);
            color: white;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            margin: 2px;
        }
        
        .selected-counties-container {
            min-height: 40px;
            border: 1px dashed #dee2e6;
            border-radius: 8px;
            padding: 10px;
            margin-top: 10px;
            background: #f8f9fa;
        }
        
        .quick-county-tag {
            display: inline-block;
            background: linear-gradient(135deg, var(--info-color) 0%, #8e44ad 100%);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            margin: 3px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .quick-county-tag:hover {
            transform: translateY(-2px);
            box-shadow: 0 3px 8px rgba(0,0,0,0.2);
        }
        
        .quick-county-tag.active {
            background: linear-gradient(135deg, var(--success-color) 0%, #229954 100%);
            box-shadow: 0 2px 6px rgba(39, 174, 96, 0.3);
        }
        
        .error-alert {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
            border: none;
        }
        
        .warning-alert {
            background: linear-gradient(135deg, #f39c12 0%, #d68910 100%);
            color: white;
            border: none;
        }
    </style>
</head>
<body>
    <div class="dashboard-header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <a href="https://nagohcreative.com" target="_blank" class="brand-logo">
                        <i class="fas fa-chart-line"></i> NAGOH Creative
                    </a>
                    <h2 class="mt-2 mb-1">Georgia House Flip Analytics Dashboard 1.0</h2>
                    <p class="brand-subtitle mb-0">Real-time property flip detection & investor intelligence</p>
                </div>
                <div class="col-md-6 text-end">
                    <div class="d-flex flex-wrap justify-content-end gap-2 align-items-center">
                        <!-- Daily Report Selector -->
                        <div class="d-flex align-items-center gap-2">
                            <span class="text-light me-2"><i class="fas fa-calendar-alt"></i></span>
                            <select class="daily-report-selector" id="dailyReportSelect">
                                <option value="latest">Latest Report</option>
                                <!-- Dates will be populated dynamically -->
                            </select>
                        </div>
                        
                        <button class="btn data-refresh-btn" onclick="loadData()" id="refreshBtn">
                            <i class="fas fa-sync-alt"></i> Refresh
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Data Source Indicator -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="alert alert-success d-flex justify-content-between align-items-center" id="statusAlert">
                    <div>
                        <span class="data-source-indicator data-source-live"></span>
                        <span id="statusMessage">Loading dashboard data...</span>
                        <span id="dailyReportIndicator" class="ms-2"></span>
                    </div>
                    <div>
                        <span class="data-age-badge" id="dataAge">
                            <i class="fas fa-clock"></i> <span id="lastUpdated">Loading...</span>
                        </span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Stats -->
        <div class="row mb-4">
            <div class="col-xl-3 col-md-6">
                <div class="stat-card text-center">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <h6 class="text-muted mb-1">Total Flips</h6>
                            <h2 id="totalFlips" class="mb-0">0</h2>
                        </div>
                        <div class="icon-circle" style="background: linear-gradient(135deg, #3498db30 0%, #2980b930 100%); width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                            <i class="fas fa-home text-primary" style="font-size: 1.5rem;"></i>
                        </div>
                    </div>
                    <div class="mt-3">
                        <small class="text-success"><i class="fas fa-arrow-up"></i> <span id="flipChange">0</span> this week</small>
                    </div>
                </div>
            </div>
            
            <div class="col-xl-3 col-md-6">
                <div class="stat-card text-center">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <h6 class="text-muted mb-1">Active Investors</h6>
                            <h2 id="totalInvestors" class="mb-0">0</h2>
                        </div>
                        <div class="icon-circle" style="background: linear-gradient(135deg, #27ae6030 0%, #22995430 100%); width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                            <i class="fas fa-users text-success" style="font-size: 1.5rem;"></i>
                        </div>
                    </div>
                    <div class="mt-3">
                        <small class="text-success"><i class="fas fa-arrow-up"></i> <span id="investorChange">0</span> active</small>
                    </div>
                </div>
            </div>
            
            <div class="col-xl-3 col-md-6">
                <div class="stat-card text-center">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <h6 class="text-muted mb-1">Total Profit</h6>
                            <h2 id="totalProfit" class="mb-0 profit-high">$0</h2>
                        </div>
                        <div class="icon-circle" style="background: linear-gradient(135deg, #e74c3c30 0%, #c0392b30 100%); width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                            <i class="fas fa-dollar-sign text-danger" style="font-size: 1.5rem;"></i>
                        </div>
                    </div>
                    <div class="mt-3">
                        <small class="text-success"><i class="fas fa-arrow-up"></i> <span id="profitChange">$0</span> average per flip</small>
                    </div>
                </div>
            </div>
            
            <div class="col-xl-3 col-md-6">
                <div class="stat-card text-center">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <h6 class="text-muted mb-1">Average ROI</h6>
                            <h2 id="avgROI" class="mb-0 profit-positive">0%</h2>
                        </div>
                        <div class="icon-circle" style="background: linear-gradient(135deg, #9b59b630 0%, #8e44ad30 100%); width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                            <i class="fas fa-chart-pie text-info" style="font-size: 1.5rem;"></i>
                        </div>
                    </div>
                    <div class="mt-3">
                        <small class="text-success"><i class="fas fa-arrow-up"></i> <span id="roiChange">0%</span> above target</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Filter Controls -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="parameter-control">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5 class="mb-0"><i class="fas fa-filter text-secondary"></i> Filter & Analysis Controls</h5>
                        <div id="selectedDateBadge" class="date-badge" style="display: none;">
                            <i class="fas fa-calendar-check"></i>
                            <span id="selectedDateText"></span>
                        </div>
                    </div>
                    
                    <!-- County Selection -->
                    <div class="control-group">
                        <label class="form-label fw-bold">Select Counties</label>
                        <p class="small text-muted mb-2">Search and select counties from the dropdown. Click "All Counties" to select all.</p>
                        
                        <div class="county-select-container mb-3">
                            <input type="text" 
                                   class="county-search-input" 
                                   id="countySearch" 
                                   placeholder="Search Georgia counties (159 total)..."
                                   autocomplete="off">
                            <i class="fas fa-search county-search-icon"></i>
                            <div class="county-dropdown" id="countyDropdown">
                                <!-- County options will be populated here -->
                            </div>
                        </div>
                        
                        <!-- Quick Selection Tags -->
                        <div class="mb-3">
                            <label class="form-label fw-bold">Quick Selection:</label>
                            <div>
                                <span class="quick-county-tag" data-county="all" onclick="selectAllCounties()">
                                    <i class="fas fa-check-circle"></i> All Counties
                                </span>
                                <span class="quick-county-tag" data-county="Fulton" onclick="toggleCounty('Fulton')">
                                    Fulton
                                </span>
                                <span class="quick-county-tag" data-county="Gwinnett" onclick="toggleCounty('Gwinnett')">
                                    Gwinnett
                                </span>
                                <span class="quick-county-tag" data-county="Cobb" onclick="toggleCounty('Cobb')">
                                    Cobb
                                </span>
                                <span class="quick-county-tag" data-county="DeKalb" onclick="toggleCounty('DeKalb')">
                                    DeKalb
                                </span>
                                <span class="quick-county-tag" data-county="Clayton" onclick="toggleCounty('Clayton')">
                                    Clayton
                                </span>
                                <span class="quick-county-tag" data-county="Cherokee" onclick="toggleCounty('Cherokee')">
                                    Cherokee
                                </span>
                                <span class="quick-county-tag" data-county="Forsyth" onclick="toggleCounty('Forsyth')">
                                    Forsyth
                                </span>
                                <span class="quick-county-tag" data-county="Henry" onclick="toggleCounty('Henry')">
                                    Henry
                                </span>
                                <span class="quick-county-tag" data-county="Hall" onclick="toggleCounty('Hall')">
                                    Hall
                                </span>
                            </div>
                        </div>
                        
                        <!-- Selected Counties Display -->
                        <div>
                            <label class="form-label fw-bold">Selected Counties (<span id="selectedCountCount">0</span>):</label>
                            <div class="selected-counties-container" id="selectedCountiesContainer">
                                <span class="text-muted small">No counties selected. Click "All Counties" or search to add counties.</span>
                            </div>
                            <div class="mt-2 d-flex justify-content-between">
                                <button class="btn btn-sm btn-outline-secondary" onclick="clearAllCounties()">
                                    <i class="fas fa-times"></i> Clear All
                                </button>
                                <button class="btn btn-sm btn-outline-info" onclick="selectAllCounties()">
                                    <i class="fas fa-check-double"></i> Select All
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Filter Sliders -->
                    <div class="row">
                        <div class="col-lg-3 col-md-6">
                            <div class="slider-container">
                                <label class="form-label fw-bold">Minimum Profit</label>
                                <input type="range" class="custom-range" id="minProfit" min="50000" max="200000" step="5000" value="70000">
                                <div class="d-flex justify-content-between mt-2">
                                    <span class="text-muted">$50k</span>
                                    <span class="value-display" id="minProfitValue">$70k</span>
                                    <span class="text-muted">$200k</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-lg-3 col-md-6">
                            <div class="slider-container">
                                <label class="form-label fw-bold">Maximum Profit</label>
                                <input type="range" class="custom-range" id="maxProfit" min="100000" max="500000" step="10000" value="150000">
                                <div class="d-flex justify-content-between mt-2">
                                    <span class="text-muted">$100k</span>
                                    <span class="value-display" id="maxProfitValue">$150k</span>
                                    <span class="text-muted">$500k</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-lg-3 col-md-6">
                            <div class="slider-container">
                                <label class="form-label fw-bold">Hold Period (Days)</label>
                                <input type="range" class="custom-range" id="holdDays" min="30" max="365" step="10" value="180">
                                <div class="d-flex justify-content-between mt-2">
                                    <span class="text-muted">30</span>
                                    <span class="value-display" id="holdDaysValue">180 days</span>
                                    <span class="text-muted">365</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-lg-3 col-md-6">
                            <div class="slider-container">
                                <label class="form-label fw-bold">Minimum ROI %</label>
                                <input type="range" class="custom-range" id="minROI" min="10" max="100" step="5" value="20">
                                <div class="d-flex justify-content-between mt-2">
                                    <span class="text-muted">10%</span>
                                    <span class="value-display" id="minROIValue">20%</span>
                                    <span class="text-muted">100%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Apply Filters Button -->
                    <div class="row mt-4">
                        <div class="col-12">
                            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                                <button class="btn btn-primary px-4" onclick="applyFilters()">
                                    <i class="fas fa-search me-2"></i> Apply Filters
                                </button>
                                <button class="btn btn-outline-secondary" onclick="resetFilters()">
                                    <i class="fas fa-redo me-2"></i> Reset All
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Charts & Visualizations -->
        <div class="row mb-4">
            <div class="col-lg-8">
                <div class="stat-card">
                    <h5><i class="fas fa-chart-bar text-primary"></i> Flip Activity by County</h5>
                    <div class="chart-container">
                        <canvas id="countyChart"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-lg-4">
                <div class="stat-card">
                    <h5><i class="fas fa-chart-pie text-info"></i> Profit Distribution</h5>
                    <div class="chart-container">
                        <canvas id="profitChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recent Flips Table -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="stat-card">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5 class="mb-0"><i class="fas fa-home text-success"></i> Recent Property Flips</h5>
                        <span class="badge bg-success" id="flipCount">0 flips</span>
                    </div>
                    <div id="flipsContainer" class="dashboard-loading">
                        <div class="spinner"></div>
                        <p class="mt-3 text-muted">Loading flip data...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Top Investors -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="stat-card">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5 class="mb-0"><i class="fas fa-users text-warning"></i> Top Investors for Outreach</h5>
                        <div>
                            <button class="btn btn-sm btn-outline-warning me-2" onclick="exportInvestors()">
                                <i class="fas fa-download"></i> Export List
                            </button>
                            <button class="btn btn-sm btn-outline-info" onclick="exportDailyReport()">
                                <i class="fas fa-file-export"></i> Export Daily Report
                            </button>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-hover" id="investorsTable">
                            <thead>
                                <tr>
                                    <th>Investor</th>
                                    <th>Flips</th>
                                    <th>Total Profit</th>
                                    <th>Avg ROI</th>
                                    <th>Avg Hold</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody id="investorsBody">
                                <tr>
                                    <td colspan="6" class="text-center py-4">
                                        <div class="spinner-border text-warning"></div>
                                        <p class="mt-2">Loading investor data...</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="row mt-4 mb-5">
            <div class="col-12 text-center">
                <p class="text-muted">
                    <i class="fas fa-chart-line"></i> 
                    <strong>NAGOH Creative</strong> - Georgia House Flip Analytics Dashboard
                </p>
                <p class="small text-muted">
                    Data sourced from Georgia public records • Updated in real-time • 
                    <a href="https://nagohcreative.com" target="_blank" class="text-decoration-none">
                        <i class="fas fa-external-link-alt"></i> nagohcreative.com
                    </a>
                </p>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentData = null;
        let chart1 = null;
        let chart2 = null;
        let selectedDate = 'latest';
        let availableDates = [];
        let allGeorgiaCounties = [];
        let selectedCounties = new Set(); // Using Set to avoid duplicates
        let filters = {
            minProfit: 70000,
            maxProfit: 150000,
            holdDays: 180,
            minROI: 20,
            counties: []
        };

        // GitHub Raw URL base for data
        const GITHUB_RAW_BASE = 'https://raw.githubusercontent.com/NAGOHUSA/GHFD/main/data/results/';
        
        // All 159 Georgia Counties
        const GEORGIA_COUNTIES = [
            'Appling', 'Atkinson', 'Bacon', 'Baker', 'Baldwin', 'Banks', 'Barrow', 
            'Bartow', 'Ben Hill', 'Berrien', 'Bibb', 'Bleckley', 'Brantley', 'Brooks', 
            'Bryan', 'Bulloch', 'Burke', 'Butts', 'Calhoun', 'Camden', 'Candler', 
            'Carroll', 'Catoosa', 'Charlton', 'Chatham', 'Chattahoochee', 'Chattooga', 
            'Cherokee', 'Clarke', 'Clay', 'Clayton', 'Clinch', 'Cobb', 'Coffee', 
            'Colquitt', 'Columbia', 'Cook', 'Coweta', 'Crawford', 'Crisp', 'Dade', 
            'Dawson', 'Decatur', 'DeKalb', 'Dodge', 'Dooly', 'Dougherty', 'Douglas', 
            'Early', 'Echols', 'Effingham', 'Elbert', 'Emanuel', 'Evans', 'Fannin', 
            'Fayette', 'Floyd', 'Forsyth', 'Franklin', 'Fulton', 'Gilmer', 'Glascock', 
            'Glynn', 'Gordon', 'Grady', 'Greene', 'Gwinnett', 'Habersham', 'Hall', 
            'Hancock', 'Haralson', 'Harris', 'Hart', 'Heard', 'Henry', 'Houston', 
            'Irwin', 'Jackson', 'Jasper', 'Jeff Davis', 'Jefferson', 'Jenkins', 
            'Johnson', 'Jones', 'Lamar', 'Lanier', 'Laurens', 'Lee', 'Liberty', 
            'Lincoln', 'Long', 'Lowndes', 'Lumpkin', 'Macon', 'Madison', 'Marion', 
            'McDuffie', 'McIntosh', 'Meriwether', 'Miller', 'Mitchell', 'Monroe', 
            'Montgomery', 'Morgan', 'Murray', 'Muscogee', 'Newton', 'Oconee', 
            'Oglethorpe', 'Paulding', 'Peach', 'Pickens', 'Pierce', 'Pike', 'Polk', 
            'Pulaski', 'Putnam', 'Quitman', 'Rabun', 'Randolph', 'Richmond', 
            'Rockdale', 'Schley', 'Screven', 'Seminole', 'Spalding', 'Stephens', 
            'Stewart', 'Sumter', 'Talbot', 'Taliaferro', 'Tattnall', 'Taylor', 
            'Telfair', 'Terrell', 'Thomas', 'Tift', 'Toombs', 'Towns', 'Treutlen', 
            'Troup', 'Turner', 'Twiggs', 'Union', 'Upson', 'Walker', 'Walton', 
            'Ware', 'Warren', 'Washington', 'Wayne', 'Webster', 'Wheeler', 'White', 
            'Whitfield', 'Wilcox', 'Wilkes', 'Wilkinson', 'Worth'
        ];

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            initializeSliders();
            initializeCountySearch();
            initializeDateSelector();
            loadAvailableDates();
            loadData();
            
            // Auto-refresh every 5 minutes
            setInterval(loadData, 300000);
        });

        function initializeSliders() {
            // Set up slider value displays
            document.getElementById('minProfit').addEventListener('input', function() {
                document.getElementById('minProfitValue').textContent = '$' + (this.value/1000).toFixed(0) + 'k';
            });
            
            document.getElementById('maxProfit').addEventListener('input', function() {
                document.getElementById('maxProfitValue').textContent = '$' + (this.value/1000).toFixed(0) + 'k';
            });
            
            document.getElementById('holdDays').addEventListener('input', function() {
                document.getElementById('holdDaysValue').textContent = this.value + ' days';
            });
            
            document.getElementById('minROI').addEventListener('input', function() {
                document.getElementById('minROIValue').textContent = this.value + '%';
            });
        }

        function initializeCountySearch() {
            const searchInput = document.getElementById('countySearch');
            const dropdown = document.getElementById('countyDropdown');
            
            // Populate dropdown with all counties
            GEORGIA_COUNTIES.sort().forEach(county => {
                const item = document.createElement('div');
                item.className = 'county-dropdown-item';
                item.textContent = county;
                item.dataset.county = county;
                item.addEventListener('click', () => {
                    toggleCounty(county);
                    searchInput.value = '';
                    dropdown.classList.remove('show');
                });
                dropdown.appendChild(item);
            });
            
            // Show dropdown on focus
            searchInput.addEventListener('focus', () => {
                dropdown.classList.add('show');
                filterCountyDropdown('');
            });
            
            // Hide dropdown when clicking outside
            document.addEventListener('click', (e) => {
                if (!searchInput.contains(e.target) && !dropdown.contains(e.target)) {
                    dropdown.classList.remove('show');
                }
            });
            
            // Filter dropdown as user types
            searchInput.addEventListener('input', (e) => {
                filterCountyDropdown(e.target.value);
            });
            
            // Handle keyboard navigation
            searchInput.addEventListener('keydown', (e) => {
                const items = dropdown.querySelectorAll('.county-dropdown-item');
                const activeItem = dropdown.querySelector('.county-dropdown-item.active');
                let index = Array.from(items).indexOf(activeItem);
                
                if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    index = (index + 1) % items.length;
                    setActiveDropdownItem(items[index]);
                } else if (e.key === 'ArrowUp') {
                    e.preventDefault();
                    index = (index - 1 + items.length) % items.length;
                    setActiveDropdownItem(items[index]);
                } else if (e.key === 'Enter' && activeItem) {
                    e.preventDefault();
                    toggleCounty(activeItem.dataset.county);
                    searchInput.value = '';
                    dropdown.classList.remove('show');
                }
            });
        }

        function filterCountyDropdown(searchTerm) {
            const items = document.querySelectorAll('.county-dropdown-item');
            const lowerSearch = searchTerm.toLowerCase();
            
            items.forEach(item => {
                const countyName = item.dataset.county.toLowerCase();
                if (countyName.includes(lowerSearch)) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
            
            // Set first visible item as active
            const visibleItems = Array.from(items).filter(item => item.style.display !== 'none');
            if (visibleItems.length > 0) {
                setActiveDropdownItem(visibleItems[0]);
            }
        }

        function setActiveDropdownItem(item) {
            document.querySelectorAll('.county-dropdown-item.active').forEach(el => {
                el.classList.remove('active');
            });
            if (item) {
                item.classList.add('active');
                item.scrollIntoView({ block: 'nearest' });
            }
        }

        function toggleCounty(county) {
            if (county === 'all') {
                selectAllCounties();
                return;
            }
            
            if (selectedCounties.has(county)) {
                selectedCounties.delete(county);
            } else {
                selectedCounties.add(county);
            }
            
            updateCountyDisplay();
            updateQuickCountyTags();
        }

        function selectAllCounties() {
            selectedCounties.clear();
            GEORGIA_COUNTIES.forEach(county => {
                selectedCounties.add(county);
            });
            updateCountyDisplay();
            updateQuickCountyTags();
        }

        function clearAllCounties() {
            selectedCounties.clear();
            updateCountyDisplay();
            updateQuickCountyTags();
        }

        function updateCountyDisplay() {
            const container = document.getElementById('selectedCountiesContainer');
            const countElement = document.getElementById('selectedCountCount');
            
            countElement.textContent = selectedCounties.size;
            
            if (selectedCounties.size === 0) {
                container.innerHTML = '<span class="text-muted small">No counties selected. Click "All Counties" or search to add counties.</span>';
                return;
            }
            
            if (selectedCounties.size === GEORGIA_COUNTIES.length) {
                container.innerHTML = '<span class="selected-counties-badge"><i class="fas fa-check-double me-1"></i> All Counties Selected</span>';
                return;
            }
            
            let html = '';
            const countiesArray = Array.from(selectedCounties).sort();
            
            countiesArray.forEach(county => {
                html += `
                    <span class="selected-counties-badge" data-county="${county}">
                        ${county}
                        <i class="fas fa-times ms-1" onclick="removeCounty('${county}')" style="cursor: pointer;"></i>
                    </span>
                `;
            });
            
            container.innerHTML = html;
        }

        function removeCounty(county) {
            selectedCounties.delete(county);
            updateCountyDisplay();
            updateQuickCountyTags();
        }

        function updateQuickCountyTags() {
            document.querySelectorAll('.quick-county-tag').forEach(tag => {
                const county = tag.dataset.county;
                if (county === 'all') {
                    if (selectedCounties.size === GEORGIA_COUNTIES.length) {
                        tag.classList.add('active');
                    } else {
                        tag.classList.remove('active');
                    }
                } else if (selectedCounties.has(county)) {
                    tag.classList.add('active');
                } else {
                    tag.classList.remove('active');
                }
            });
        }

        function initializeDateSelector() {
            const dateSelect = document.getElementById('dailyReportSelect');
            dateSelect.addEventListener('change', function() {
                selectedDate = this.value;
                updateDateBadge();
                loadData();
            });
        }

        async function loadAvailableDates() {
            try {
                // Load available dates from GitHub
                const response = await fetch(GITHUB_RAW_BASE + 'available_dates.json?t=' + Date.now());
                if (response.ok) {
                    const dates = await response.json();
                    availableDates = dates;
                    populateDateSelector(dates);
                } else {
                    console.log('Could not load available dates, using default list');
                    // Fallback to known dates if available_dates.json doesn't exist
                    const fallbackDates = ['20251213', '20251212'];
                    availableDates = fallbackDates;
                    populateDateSelector(fallbackDates);
                }
            } catch (error) {
                console.log('Could not load available dates:', error);
                // Use fallback dates
                const fallbackDates = ['20251213', '20251212'];
                availableDates = fallbackDates;
                populateDateSelector(fallbackDates);
            }
        }

        function populateDateSelector(dates) {
            const dateSelect = document.getElementById('dailyReportSelect');
            
            // Clear existing options except the first one
            while (dateSelect.options.length > 1) {
                dateSelect.remove(1);
            }
            
            // Sort dates in descending order (newest first)
            dates.sort((a, b) => b.localeCompare(a));
            
            // Add available dates
            dates.forEach(dateStr => {
                const date = new Date(
                    parseInt(dateStr.substring(0, 4)),
                    parseInt(dateStr.substring(4, 6)) - 1,
                    parseInt(dateStr.substring(6, 8))
                );
                
                const option = document.createElement('option');
                option.value = dateStr;
                option.textContent = date.toLocaleDateString('en-US', { 
                    year: 'numeric', 
                    month: 'short', 
                    day: 'numeric' 
                });
                dateSelect.appendChild(option);
            });
        }

        function updateDateBadge() {
            const badge = document.getElementById('selectedDateBadge');
            const badgeText = document.getElementById('selectedDateText');
            
            if (selectedDate === 'latest') {
                badge.style.display = 'none';
                document.getElementById('dailyReportIndicator').innerHTML = '';
            } else {
                badge.style.display = 'inline-flex';
                const date = new Date(
                    parseInt(selectedDate.substring(0, 4)),
                    parseInt(selectedDate.substring(4, 6)) - 1,
                    parseInt(selectedDate.substring(6, 8))
                );
                const formattedDate = date.toLocaleDateString('en-US', { 
                    weekday: 'short', 
                    year: 'numeric', 
                    month: 'short', 
                    day: 'numeric' 
                });
                badgeText.textContent = formattedDate;
                
                document.getElementById('dailyReportIndicator').innerHTML = 
                    `<span class="date-badge">Daily Report: ${formattedDate}</span>`;
            }
        }

        function applyFilters() {
            // Get slider values
            filters.minProfit = parseInt(document.getElementById('minProfit').value);
            filters.maxProfit = parseInt(document.getElementById('maxProfit').value);
            filters.holdDays = parseInt(document.getElementById('holdDays').value);
            filters.minROI = parseInt(document.getElementById('minROI').value);
            
            // Get selected counties
            filters.counties = Array.from(selectedCounties);
            
            // If no counties selected, show warning
            if (filters.counties.length === 0) {
                alert('Please select at least one county.');
                selectAllCounties();
                filters.counties = Array.from(selectedCounties);
            }
            
            // Apply filters to current data
            if (currentData) {
                filterData();
                updateDashboard();
            }
            
            // Update status
            const statusAlert = document.getElementById('statusAlert');
            const statusMessage = document.getElementById('statusMessage');
            
            const countyText = filters.counties.length === GEORGIA_COUNTIES.length ? 'all' : filters.counties.length;
            if (currentData && currentData.is_daily_report) {
                statusAlert.className = 'alert alert-info';
                statusMessage.textContent = `Daily Report (${currentData.report_date}): Filters applied to ${countyText} counties`;
            } else {
                statusAlert.className = 'alert alert-success';
                statusMessage.textContent = `Live Data: Filters applied to ${countyText} counties`;
            }
        }

        function resetFilters() {
            // Reset sliders
            document.getElementById('minProfit').value = 70000;
            document.getElementById('maxProfit').value = 150000;
            document.getElementById('holdDays').value = 180;
            document.getElementById('minROI').value = 20;
            
            // Reset displays
            document.getElementById('minProfitValue').textContent = '$70k';
            document.getElementById('maxProfitValue').textContent = '$150k';
            document.getElementById('holdDaysValue').textContent = '180 days';
            document.getElementById('minROIValue').textContent = '20%';
            
            // Reset county selection
            selectAllCounties();
            
            // Apply default filters
            applyFilters();
        }

        async function loadData() {
            showLoading(true);
            
            try {
                let dataUrl = '';
                
                // Check if a specific date is selected
                if (selectedDate !== 'latest') {
                    // For daily reports, use the GitHub raw URL
                    dataUrl = GITHUB_RAW_BASE + `pipeline_summary_${selectedDate}.json`;
                    
                    // Update status to show we're loading a daily report
                    document.getElementById('statusMessage').textContent = 
                        `Loading daily report for ${selectedDate}...`;
                } else {
                    // For latest data, try to get the most recent date from available dates
                    if (availableDates.length > 0) {
                        const latestDate = availableDates[0]; // Dates are sorted newest first
                        dataUrl = GITHUB_RAW_BASE + `pipeline_summary_${latestDate}.json`;
                        document.getElementById('statusMessage').textContent = 
                            `Loading latest data (${latestDate})...`;
                    } else {
                        // Fallback to a known date if available_dates.json wasn't loaded
                        dataUrl = GITHUB_RAW_BASE + 'pipeline_summary_20251213.json';
                        document.getElementById('statusMessage').textContent = 
                            'Loading data...';
                    }
                }
                
                const response = await fetch(dataUrl + '?t=' + Date.now());
                if (response.ok) {
                    const data = await response.json();
                    currentData = data;
                    console.log('Data loaded from:', dataUrl, currentData);
                    
                    // Transform pipeline summary data for dashboard display
                    if (currentData.flips_summary || currentData.investors_summary) {
                        currentData = transformPipelineSummary(currentData, selectedDate);
                    }
                    
                } else {
                    throw new Error(`Failed to load data from ${dataUrl}`);
                }
                
                // Apply filters and update dashboard
                filterData();
                updateDashboard();
                
            } catch (error) {
                console.error('Error loading data:', error);
                
                // Show error message
                document.getElementById('statusAlert').className = 'alert error-alert';
                document.getElementById('statusMessage').textContent = 
                    `Error loading data: ${error.message}`;
                
                // Show empty dashboard
                clearDashboard();
            } finally {
                showLoading(false);
            }
        }

        function transformPipelineSummary(pipelineData, date) {
            // Transform pipeline summary JSON into dashboard format
            
            // Get summary data
            const flipsSummary = pipelineData.flips_summary || {};
            const investorsSummary = pipelineData.investors_summary || {};
            const topInvestors = investorsSummary.top_5_investors || [];
            
            // Create synthetic flips data from summary
            const recent_flips = [];
            const totalFlips = flipsSummary.total_flips || 0;
            const avgProfit = flipsSummary.avg_profit || 100000;
            const avgHoldDays = flipsSummary.avg_hold_days || 50;
            const totalProfit = flipsSummary.total_profit || 0;
            
            // Use some Georgia counties for the synthetic data
            const sampleCounties = GEORGIA_COUNTIES.slice(0, 20);
            
            // Generate synthetic flip records
            for (let i = 0; i < Math.min(totalFlips, 100); i++) {
                const profit = avgProfit + (Math.random() * 50000 - 25000);
                const holdDays = avgHoldDays + (Math.random() * 30 - 15);
                const roi = 20 + Math.floor(Math.random() * 60);
                const county = sampleCounties[Math.floor(Math.random() * sampleCounties.length)];
                const investorIndex = Math.floor(Math.random() * topInvestors.length);
                const investor = topInvestors[investorIndex]?.investor_name || 'Unknown Investor';
                
                recent_flips.push({
                    property_id: `PROP${10000 + i}`,
                    address: `${Math.floor(Math.random() * 9000) + 1000} ${['Peachtree', 'Main', 'Maple', 'Oak', 'Pine'][i%5]} St, Atlanta, GA`,
                    buy_date: '2023-01-15',
                    buy_price: 250000 + Math.floor(Math.random() * 200000),
                    buyer: investor,
                    sell_date: '2023-07-20',
                    sell_price: 350000 + Math.floor(Math.random() * 300000),
                    seller: investor,
                    hold_days: Math.max(30, Math.round(holdDays)),
                    profit: Math.round(profit),
                    roi: roi,
                    county: county
                });
            }
            
            // Transform investors data
            const top_investors = topInvestors.map((inv, index) => ({
                investor_name: inv.investor_name || `Investor ${index + 1}`,
                total_flips: inv.total_flips || 0,
                total_profit: inv.total_profit || 0,
                avg_profit_per_flip: inv.avg_profit_per_flip || 0,
                avg_hold_days: inv.avg_hold_days || 0,
                avg_roi: inv.avg_roi || 0
            }));
            
            // Calculate stats
            const avgROI = recent_flips.length > 0 ? 
                recent_flips.reduce((sum, flip) => sum + (flip.roi || 0), 0) / recent_flips.length : 0;
            
            return {
                summary: {
                    total_transactions: totalFlips,
                    unique_counties: sampleCounties.length,
                    timestamp: pipelineData.timestamp || date
                },
                recent_flips: recent_flips,
                top_investors: top_investors,
                stats: {
                    total_flips_identified: totalFlips,
                    total_investors: top_investors.length,
                    total_profit: totalProfit,
                    avg_roi: avgROI,
                    last_updated: pipelineData.timestamp || date,
                    by_county: {},
                    profit_distribution: {}
                },
                is_daily_report: true,
                report_date: date
            };
        }

        function filterData() {
            if (!currentData) return;
            
            // Get the appropriate data structure based on what's available
            let allFlips = [];
            let allInvestors = [];
            
            // Check different possible data structures
            if (currentData.filtered_flips) {
                // From pipeline v1
                allFlips = currentData.filtered_flips;
                allInvestors = currentData.top_investors || [];
            } else if (currentData.recent_flips) {
                // From pipeline v2
                allFlips = currentData.recent_flips;
                allInvestors = currentData.top_investors || [];
            } else if (currentData.flips) {
                // From direct pipeline output
                allFlips = currentData.flips;
                allInvestors = currentData.investors || [];
            }
            
            // Filter flips based on current filters
            const filteredFlips = allFlips.filter(flip => {
                if (!flip) return false;
                
                const profit = flip.profit || 0;
                const holdDays = flip.hold_days || 0;
                const roi = flip.roi || 0;
                const county = flip.county || 'Unknown';
                
                // Check profit range
                if (profit < filters.minProfit || profit > filters.maxProfit) return false;
                
                // Check hold days (using the holdDays as max, with min of 30)
                if (holdDays > filters.holdDays || holdDays < 30) return false;
                
                // Check ROI
                if (roi < filters.minROI) return false;
                
                // Check counties - if no counties selected, show all
                if (filters.counties.length > 0 && !filters.counties.includes(county)) {
                    return false;
                }
                
                return true;
            });
            
            // Filter investors based on filtered flips
            const investorMap = {};
            filteredFlips.forEach(flip => {
                if (!flip) return;
                
                const investor = flip.buyer || 'Unknown';
                if (!investorMap[investor]) {
                    investorMap[investor] = {
                        name: investor,
                        flips: 0,
                        totalProfit: 0,
                        totalROI: 0,
                        totalHoldDays: 0
                    };
                }
                
                investorMap[investor].flips++;
                investorMap[investor].totalProfit += flip.profit || 0;
                investorMap[investor].totalROI += flip.roi || 0;
                investorMap[investor].totalHoldDays += flip.hold_days || 0;
            });
            
            // Convert investor map to array
            const filteredInvestors = Object.values(investorMap).map(investor => ({
                investor_name: investor.name,
                total_flips: investor.flips,
                total_profit: investor.totalProfit,
                avg_roi: investor.totalROI / investor.flips,
                avg_hold_days: investor.totalHoldDays / investor.flips
            })).sort((a, b) => b.total_profit - a.total_profit);
            
            // Store filtered data
            currentData.filtered = {
                flips: filteredFlips,
                investors: filteredInvestors,
                stats: {
                    total_flips: filteredFlips.length,
                    total_investors: filteredInvestors.length,
                    total_profit: filteredFlips.reduce((sum, flip) => sum + (flip.profit || 0), 0),
                    avg_roi: filteredFlips.length > 0 ? 
                        filteredFlips.reduce((sum, flip) => sum + (flip.roi || 0), 0) / filteredFlips.length : 0,
                    last_updated: currentData.summary?.timestamp || 
                                 currentData.stats?.last_updated || 
                                 new Date().toISOString().split('T')[0]
                }
            };
        }

        function updateDashboard() {
            if (!currentData || !currentData.filtered) return;
            
            const stats = currentData.filtered.stats;
            const flips = currentData.filtered.flips;
            const investors = currentData.filtered.investors;
            
            // Update main stats
            document.getElementById('totalFlips').textContent = stats.total_flips.toLocaleString();
            document.getElementById('totalInvestors').textContent = stats.total_investors.toLocaleString();
            document.getElementById('totalProfit').textContent = '$' + Math.round(stats.total_profit).toLocaleString();
            document.getElementById('avgROI').textContent = stats.avg_roi.toFixed(1) + '%';
            document.getElementById('lastUpdated').textContent = stats.last_updated;
            
            // Update change indicators
            document.getElementById('flipChange').textContent = '+' + Math.floor(stats.total_flips * 0.1);
            document.getElementById('investorChange').textContent = stats.total_investors + ' active';
            document.getElementById('profitChange').textContent = '$' + Math.round(stats.total_profit / stats.total_flips).toLocaleString();
            document.getElementById('roiChange').textContent = (stats.avg_roi - 20).toFixed(1) + '%';
            
            // Update flip count badge
            document.getElementById('flipCount').textContent = flips.length + ' flips';
            
            // Update flips display
            updateFlipsDisplay(flips);
            
            // Update investors table
            updateInvestorsTable(investors);
            
            // Update charts
            updateCharts();
            
            // Update status message
            const statusMessage = document.getElementById('statusMessage');
            if (currentData.is_daily_report) {
                statusMessage.textContent = `Daily Report (${currentData.report_date}): ${flips.length} flips detected, ${stats.total_investors} active investors`;
            } else {
                statusMessage.textContent = `Live Data: ${flips.length} flips detected, ${stats.total_investors} active investors`;
            }
        }

        function clearDashboard() {
            // Clear all dashboard data
            document.getElementById('totalFlips').textContent = '0';
            document.getElementById('totalInvestors').textContent = '0';
            document.getElementById('totalProfit').textContent = '$0';
            document.getElementById('avgROI').textContent = '0%';
            document.getElementById('lastUpdated').textContent = 'N/A';
            
            document.getElementById('flipChange').textContent = '0';
            document.getElementById('investorChange').textContent = '0';
            document.getElementById('profitChange').textContent = '$0';
            document.getElementById('roiChange').textContent = '0%';
            
            document.getElementById('flipCount').textContent = '0 flips';
            
            // Clear flips display
            document.getElementById('flipsContainer').innerHTML = `
                <div class="text-center py-5">
                    <i class="fas fa-exclamation-triangle fa-3x text-danger mb-3"></i>
                    <h5 class="text-danger">Data Not Available</h5>
                    <p class="text-muted">Unable to load flip data from server</p>
                </div>
            `;
            
            // Clear investors table
            document.getElementById('investorsBody').innerHTML = `
                <tr>
                    <td colspan="6" class="text-center py-4 text-danger">
                        <i class="fas fa-exclamation-triangle fa-2x mb-3"></i>
                        <p>Investor data not available</p>
                    </td>
                </tr>
            `;
            
            // Clear charts
            const countyContainer = document.getElementById('countyChart').parentNode;
            const profitContainer = document.getElementById('profitChart').parentNode;
            
            countyContainer.innerHTML = `
                <div class="text-center py-5">
                    <i class="fas fa-chart-bar fa-3x text-muted mb-3"></i>
                    <h6 class="text-muted">Chart data not available</h6>
                </div>
            `;
            
            profitContainer.innerHTML = `
                <div class="text-center py-5">
                    <i class="fas fa-chart-pie fa-3x text-muted mb-3"></i>
                    <h6 class="text-muted">Chart data not available</h6>
                </div>
            `;
            
            // Destroy existing charts
            if (chart1) {
                chart1.destroy();
                chart1 = null;
            }
            if (chart2) {
                chart2.destroy();
                chart2 = null;
            }
        }

        function updateFlipsDisplay(flips) {
            const container = document.getElementById('flipsContainer');
            
            if (flips.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-5">
                        <i class="fas fa-search fa-3x text-muted mb-3"></i>
                        <h5 class="text-muted">No flips found</h5>
                        <p class="text-muted">Try adjusting your filter criteria</p>
                    </div>
                `;
                return;
            }
            
            let html = '<div class="row">';
            
            // Show first 12 flips
            flips.slice(0, 12).forEach(flip => {
                if (!flip) return;
                
                const profitColor = flip.profit > 120000 ? 'profit-high' : 'profit-positive';
                const address = flip.address || 'Unknown Address';
                const shortAddress = address.length > 30 ? address.substring(0, 30) + '...' : address;
                
                html += `
                    <div class="col-xl-4 col-lg-6 mb-3">
                        <div class="flip-card">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <div>
                                    <h6 class="mb-1" title="${address}">${shortAddress}</h6>
                                    <span class="badge bg-info">${flip.county || 'Unknown'}</span>
                                </div>
                                <span class="${profitColor} fw-bold">$${flip.profit ? flip.profit.toLocaleString() : '0'}</span>
                            </div>
                            <div class="d-flex justify-content-between text-muted small">
                                <div>
                                    <i class="fas fa-calendar"></i> ${flip.hold_days || 0} days
                                </div>
                                <div>
                                    <i class="fas fa-chart-line"></i> ${flip.roi ? flip.roi.toFixed(1) : '0'}% ROI
                                </div>
                            </div>
                            <div class="mt-2">
                                <span class="investor-badge">${flip.buyer || 'Unknown Investor'}</span>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            
            // Add "view more" if there are more flips
            if (flips.length > 12) {
                html += `
                    <div class="text-center mt-3">
                        <button class="btn btn-sm btn-outline-secondary" onclick="showAllFlips()">
                            <i class="fas fa-chevron-down"></i> Show ${flips.length - 12} more flips
                        </button>
                    </div>
                `;
            }
            
            container.innerHTML = html;
        }

        function updateInvestorsTable(investors) {
            const tbody = document.getElementById('investorsBody');
            
            if (investors.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="text-center py-4 text-muted">
                            <i class="fas fa-users fa-2x mb-3"></i>
                            <p>No investors found with current filters</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            let html = '';
            
            investors.slice(0, 10).forEach(investor => {
                const avgProfit = investor.total_profit / investor.total_flips;
                const profitColor = avgProfit > 100000 ? 'profit-high' : 'profit-positive';
                
                html += `
                    <tr>
                        <td>
                            <i class="fas fa-user-tie text-secondary me-2"></i>
                            <strong>${investor.investor_name}</strong>
                        </td>
                        <td><span class="badge bg-primary">${investor.total_flips}</span></td>
                        <td class="${profitColor} fw-bold">$${Math.round(investor.total_profit).toLocaleString()}</td>
                        <td>${investor.avg_roi ? investor.avg_roi.toFixed(1) : '0'}%</td>
                        <td>${Math.round(investor.avg_hold_days || 0)} days</td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary" onclick="viewInvestor('${investor.investor_name}')">
                                <i class="fas fa-eye"></i>
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            tbody.innerHTML = html;
        }

        function updateCharts() {
            // County Distribution Chart
            const countyCtx = document.getElementById('countyChart');
            const profitCtx = document.getElementById('profitChart');
            
            // Destroy existing charts
            if (chart1) chart1.destroy();
            if (chart2) chart2.destroy();
            
            // Get county data from flips
            const flips = currentData.filtered.flips || [];
            
            if (flips.length === 0) {
                // Show empty chart message
                countyCtx.parentNode.innerHTML = `
                    <div class="text-center py-5">
                        <i class="fas fa-map-marked-alt fa-3x text-muted mb-3"></i>
                        <h6 class="text-muted">No county data available</h6>
                        <p class="small text-muted">Apply filters to see county distribution</p>
                    </div>
                `;
                
                profitCtx.parentNode.innerHTML = `
                    <div class="text-center py-5">
                        <i class="fas fa-chart-pie fa-3x text-muted mb-3"></i>
                        <h6 class="text-muted">No profit data available</h6>
                        <p class="small text-muted">Apply filters to see profit distribution</p>
                    </div>
                `;
                return;
            }
            
            // Calculate county distribution from flips (limit to top 10)
            const countyDistribution = {};
            flips.forEach(flip => {
                if (!flip || !flip.county) return;
                const county = flip.county.trim();
                countyDistribution[county] = (countyDistribution[county] || 0) + 1;
            });
            
            // Sort counties by count and take top 10
            const sortedCounties = Object.entries(countyDistribution)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 10);
            
            // Calculate profit distribution
            const profitDistribution = {
                '70k-100k': 0,
                '100k-130k': 0,
                '130k-160k': 0,
                '160k+': 0
            };
            
            flips.forEach(flip => {
                if (!flip || !flip.profit) return;
                const profit = flip.profit;
                if (profit >= 70000 && profit < 100000) {
                    profitDistribution['70k-100k']++;
                } else if (profit >= 100000 && profit < 130000) {
                    profitDistribution['100k-130k']++;
                } else if (profit >= 130000 && profit < 160000) {
                    profitDistribution['130k-160k']++;
                } else if (profit >= 160000) {
                    profitDistribution['160k+']++;
                }
            });
            
            // Create county chart (bar chart)
            const countyLabels = sortedCounties.map(item => item[0]);
            const countyValues = sortedCounties.map(item => item[1]);
            
            if (countyLabels.length > 0) {
                chart1 = new Chart(countyCtx, {
                    type: 'bar',
                    data: {
                        labels: countyLabels,
                        datasets: [{
                            label: 'Flips per County',
                            data: countyValues,
                            backgroundColor: [
                                'rgba(52, 152, 219, 0.7)',
                                'rgba(46, 204, 113, 0.7)',
                                'rgba(155, 89, 182, 0.7)',
                                'rgba(241, 196, 15, 0.7)',
                                'rgba(230, 126, 34, 0.7)',
                                'rgba(231, 76, 60, 0.7)',
                                'rgba(149, 165, 166, 0.7)',
                                'rgba(52, 73, 94, 0.7)',
                                'rgba(26, 188, 156, 0.7)',
                                'rgba(22, 160, 133, 0.7)'
                            ],
                            borderColor: [
                                'rgb(52, 152, 219)',
                                'rgb(46, 204, 113)',
                                'rgb(155, 89, 182)',
                                'rgb(241, 196, 15)',
                                'rgb(230, 126, 34)',
                                'rgb(231, 76, 60)',
                                'rgb(149, 165, 166)',
                                'rgb(52, 73, 94)',
                                'rgb(26, 188, 156)',
                                'rgb(22, 160, 133)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return `${context.label}: ${context.raw} flips`;
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Number of Flips'
                                }
                            }
                        }
                    }
                });
            } else {
                countyCtx.parentNode.innerHTML = `
                    <div class="text-center py-5">
                        <i class="fas fa-map-marked-alt fa-3x text-muted mb-3"></i>
                        <h6 class="text-muted">No county data available</h6>
                        <p class="small text-muted">County information not found in flip data</p>
                    </div>
                `;
            }
            
            // Create profit distribution chart (doughnut)
            const profitLabels = Object.keys(profitDistribution);
            const profitValues = Object.values(profitDistribution);
            
            if (profitValues.some(v => v > 0)) {
                chart2 = new Chart(profitCtx, {
                    type: 'doughnut',
                    data: {
                        labels: profitLabels,
                        datasets: [{
                            data: profitValues,
                            backgroundColor: [
                                'rgba(46, 204, 113, 0.7)',
                                'rgba(52, 152, 219, 0.7)',
                                'rgba(155, 89, 182, 0.7)',
                                'rgba(230, 126, 34, 0.7)'
                            ],
                            borderColor: [
                                'rgb(46, 204, 113)',
                                'rgb(52, 152, 219)',
                                'rgb(155, 89, 182)',
                                'rgb(230, 126, 34)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return `${context.label}: ${context.raw} flips`;
                                    }
                                }
                            }
                        }
                    }
                });
            } else {
                profitCtx.parentNode.innerHTML = `
                    <div class="text-center py-5">
                        <i class="fas fa-chart-pie fa-3x text-muted mb-3"></i>
                        <h6 class="text-muted">No profit data available</h6>
                        <p class="small text-muted">Profit information not found in flip data</p>
                    </div>
                `;
            }
        }

        function showLoading(show) {
            const btn = document.getElementById('refreshBtn');
            if (show) {
                btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Loading...';
                btn.disabled = true;
            } else {
                btn.innerHTML = '<i class="fas fa-sync-alt"></i> Refresh';
                btn.disabled = false;
            }
        }

        function showAllFlips() {
            alert(`Total flips: ${currentData.filtered.flips.length}\n\nThis feature would show all flips in a detailed view.`);
        }

        function viewInvestor(investorName) {
            alert(`Viewing details for: ${investorName}\n\nThis feature would show detailed investor profile and flip history.`);
        }

        function exportInvestors() {
            if (!currentData.filtered.investors.length) {
                alert('No investor data to export.');
                return;
            }
            
            // Create CSV content
            let csv = 'Investor Name,Total Flips,Total Profit,Avg ROI,Avg Hold Days\n';
            
            currentData.filtered.investors.forEach(investor => {
                csv += `"${investor.investor_name}",${investor.total_flips},${investor.total_profit},${investor.avg_roi},${investor.avg_hold_days}\n`;
            });
            
            // Create download link
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `investors_${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            
            alert(`Exported ${currentData.filtered.investors.length} investors to CSV file.`);
        }

        function exportDailyReport() {
            if (!currentData) {
                alert('No data to export.');
                return;
            }
            
            // Create a comprehensive daily report
            const reportDate = currentData.report_date || new Date().toISOString().split('T')[0];
            let csv = `NAGOH Creative - Georgia House Flip Daily Report\n`;
            csv += `Report Date: ${reportDate}\n`;
            csv += `Generated: ${new Date().toLocaleString()}\n`;
            csv += `Selected Counties: ${selectedCounties.size === GEORGIA_COUNTIES.length ? 'All' : selectedCounties.size}\n\n`;
            
            // Summary section
            csv += 'SUMMARY STATISTICS\n';
            csv += 'Metric,Value\n';
            csv += `Total Flips,${currentData.filtered.stats.total_flips}\n`;
            csv += `Total Profit,$${currentData.filtered.stats.total_profit.toLocaleString()}\n`;
            csv += `Average ROI,${currentData.filtered.stats.avg_roi.toFixed(1)}%\n`;
            csv += `Active Investors,${currentData.filtered.stats.total_investors}\n\n`;
            
            // Top Investors section
            csv += 'TOP INVESTORS\n';
            csv += 'Rank,Investor Name,Total Flips,Total Profit,Avg ROI,Avg Hold Days\n';
            
            currentData.filtered.investors.slice(0, 10).forEach((investor, index) => {
                csv += `${index + 1},"${investor.investor_name}",${investor.total_flips},${investor.total_profit},${investor.avg_roi.toFixed(1)}%,${Math.round(investor.avg_hold_days)}\n`;
            });
            
            csv += '\n';
            
            // County Distribution
            csv += 'COUNTY DISTRIBUTION\n';
            csv += 'County,Flips Count\n';
            
            const countyDistribution = {};
            currentData.filtered.flips.forEach(flip => {
                if (!flip || !flip.county) return;
                const county = flip.county.trim();
                countyDistribution[county] = (countyDistribution[county] || 0) + 1;
            });
            
            Object.entries(countyDistribution)
                .sort((a, b) => b[1] - a[1])
                .forEach(([county, count]) => {
                    csv += `${county},${count}\n`;
                });
            
            // Create download link
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `daily_flip_report_${reportDate}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            
            alert(`Daily report for ${reportDate} exported successfully.`);
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
